<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel de Indicadores</title>

<style>
body{
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:20px;
}

h2{
  text-align:center;
  color:#2c3e50;
}

input{
  padding:12px;
  width:100%;
  max-width:500px;
  display:block;
  margin:15px auto;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

.table-container{
  overflow:auto;
  max-height:75vh;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  background:white;
}

table{
  border-collapse:collapse;
  width:100%;
  font-size:12px;
}

th{
  background:#34495e;
  color:white;
  padding:10px;
  position:sticky;
  top:0;
  z-index:2;
}

td{
  padding:8px;
  text-align:center;
  border-bottom:1px solid #eee;
}

tr:nth-child(even){
  background:#f9fbfd;
}

tr:hover{
  background:#e8f4ff;
}
  .kpi-verde{
  background:#d4edda;
  color:#155724;
  font-weight:bold;
}

.kpi-amarillo{
  background:#fff3cd;
  color:#856404;
  font-weight:bold;
}

.kpi-rojo{
  background:#f8d7da;
  color:#721c24;
  font-weight:bold;
}

</style>



  
</head>

<body>

<h2>ðŸ“Š Panel de Indicadores</h2>

<input type="text" id="filtro" placeholder="Buscar por cualquier dato...">

<div class="table-container">
<table>
  <thead></thead>
  <tbody></tbody>
</table>
</div>

<script>
const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTv__z4dmUZOol3wAk_xfvxVHrJHFuaP3dKX8M9S-j6dd3WjUz0iCpxGnIOzpq2s1oOKPWGf5q45Yox/pub?output=csv";

fetch(url)
.then(res => res.text())
.then(data => {
  const filas = data.trim().split("\n").map(f => f.split(","));
  const encabezados = filas[0];
  const datos = filas.slice(1);

  const thead = document.querySelector("thead");
  const tbody = document.querySelector("tbody");

  thead.innerHTML = "<tr>" + encabezados.map(h => `<th>${h}</th>`).join("") + "</tr>";

  // APLICAMOS CAMBIO DE COLOR POR ESTILO
function reglaPorColumna(encabezado, valor){
  if(!valor.includes("%")) return "";

  const num = parseFloat(valor.replace("%","").trim());
  encabezado = encabezado.trim();

  // REGLAS PERSONALIZADAS
  const reglas = {
    "% FCR 1dia": 90,
    "%FCR 7dia": 90,
    "% Adher General": 80,
    "% Descto": 80,
    "% Rein.": 5,   // menos es mejor
    "% Ef. BAF": 80,
    "% Argumentario": 85,
    "% Oferta": 85,
    "% Adh Capl": 25,   // menos es mejor
    "%adh Oferta 0": 20,   // menos es mejor
    "%adh Oferta 1": 80,
    "%adh Oferta 2": 80,
    "%adh Oferta 3": 80,
    "% VS Atendidas": 90,
    "% Baja Parc.": 4,   // menos es mejor
    "% Short Call": 5,   // aquÃ­ es al revÃ©s (menos es mejor)
    "% Transf.": 10       // menos es mejor
  };

  let meta = reglas[encabezado];

  if(meta === undefined) meta = 85; // regla general

  // Para mÃ©tricas donde MENOS es mejor
  if(encabezado === "% Short Call" || encabezado === "% Transf." || encabezado === "% Adh Capl" || encabezado === "% Rein." || encabezado === "%adh Oferta 0" || encabezado === "% Baja Parc."){
    if(num <= meta) return "kpi-verde";
    if(num <= meta + 5) return "kpi-amarillo";
    return "kpi-rojo";
  }

  // Para mÃ©tricas normales (mÃ¡s es mejor)
  if(num >= meta) return "kpi-verde";
  if(num >= meta - 10) return "kpi-amarillo";
  return "kpi-rojo";
}
// CAMBIOS EN EL RENDER
  function render(filtrado){
  tbody.innerHTML="";
  filtrado.forEach(fila=>{
    let filaHTML = "<tr>";

    fila.forEach((celda, i)=>{
      const encabezado = encabezados[i];
      const clase = reglaPorColumna(encabezado, celda);
      filaHTML += `<td class="${clase}">${celda}</td>`;
    });

    filaHTML += "</tr>";
    tbody.innerHTML += filaHTML;
  });
}

  
// despues de aplicar cambio de color
  
  render(datos);

  document.getElementById("filtro").addEventListener("keyup", e=>{
    const texto = e.target.value.toLowerCase();
    const resultado = datos.filter(fila =>
      fila.some(celda =>
        celda.toLowerCase().includes(texto)
      )
    );
    render(resultado);
  });
});
</script>

</body>
</html>


